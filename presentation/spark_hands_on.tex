\documentclass[slidetop,9pt,utf8]{beamer}

\usepackage{CJKutf8}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{ifpdf}
\usepackage{textcomp}
\usepackage{color}
\usepackage{xcolor}
\usepackage{amsmath}
\usepackage{graphics}
\usepackage{array}
\usepackage{graphicx}
\usepackage{colortbl}
\usepackage{pinyin}
\usepackage{algorithm,algorithmic}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{caption}

\usetheme{JuanLesPins}
\useoutertheme{infolines}
%\usecolortheme{default}
%\usetheme{Boadilla}
\setbeamerfont{structure}{size*={11}{11}}

\DeclareCaptionFont{white}{\color{white}}
\DeclareCaptionFormat{listing}{\colorbox[cmyk]{0.43, 0.35, 0.35,0.01}{\parbox{\textwidth}{\hspace{15pt}#1#2#3}}}
\captionsetup[lstlisting]{format=listing,labelfont=white,textfont=white, singlelinecheck=false, margin=0pt, font={bf,footnotesize}}

\lstset{
         basicstyle=\footnotesize\ttfamily,
         numberstyle=\tiny,          
         numbersep=5pt,              
         tabsize=2,                  
         extendedchars=true,         
         breaklines=true,            
         keywordstyle=\color{red},
         showspaces=false,           
         showtabs=false,             
         xleftmargin=17pt,
         xrightmargin=17pt,
         framexleftmargin=5pt,
         framexrightmargin=5pt,
         framexbottommargin=4pt,
         showstringspaces=false      
 }

\lstdefinestyle{terminal}
{
    backgroundcolor=\color{black},
    basicstyle=\scriptsize\color{white}\ttfamily
}

\lstdefinestyle{code}
{
    frame=b,
    numbers=left,
    morecomment=[is]{/\*}{\*/}
}

% "define" Scala
\lstdefinelanguage{scala}{
  morekeywords={abstract,case,catch,class,def,%
    do,else,extends,false,final,finally,%
    for,if,implicit,import,match,mixin,%
    new,null,object,override,package,%
    private,protected,requires,return,sealed,%
    super,this,throw,trait,true,try,%
    type,val,var,while,with,yield},
  otherkeywords={=>,<-,<\%,<:,>:,\#,@},
  sensitive=true,
  morecomment=[l]{//},
  morecomment=[n]{/*}{*/},
  morestring=[b]",
  morestring=[b]',
  morestring=[b]"""
}

\begin{document}
\begin{CJK}{UTF8}{gbsn}

%--- Page de titre ---
\title{Spark Hands On}
%\subtitle{Creation of a multi-features Named Entity Disambiguation System}
\author{Olivier GIRARDOT, Vincent DOBA}
\institute{Paris Scala User Group}
\date{May 13, 2015}

\frame{\titlepage}

%--- Sommaire ---
\begin{frame}
  \frametitle{Content}
  \tableofcontents[hideallsubsections]
\end{frame}

\section{Prerequisite}

%--- Prerequisite for the machine ---
\begin{frame}
  \frametitle{Machine Prerequisite}

  \begin{block}{You should have a machine with}
    \begin{itemize}
      \item JDK 6+ (this hands on was developed using Oracle JDK 8) with Scala 2.10+
      \item SBT 13+
      \item Git
      \item An IDE with SBT/Scala support (for instance IDEA IntelliJ with SBT and Scala plugins)
      \item Downloaded Spark 1.3.1 prebuilt for Hadoop 2.6 from \href{http://www.apache.org/dyn/closer.cgi/spark/spark-1.3.1/spark-1.3.1-bin-hadoop2.6.tgz}{official Apache Spark site}
    \end{itemize}
  \end{block}

  \begin{block}{You should}
    \begin{itemize}
      \item Know Scala basis
      \item Be at ease with Scala's iterables transformations (map, flatmap, fold)
      \item Be at ease with higher order functions
    \end{itemize}
  \end{block}

\end{frame}

\begin{frame}[fragile]
  \frametitle{First Spark Run}

  \begin{block}{Perform following commands}
    \begin{lstlisting}[language=bash, style=terminal]
git clone https://github.com/vincentdoba/spark-hands-on.git
cd spark-hands-on
sbt "run-main psug.hands.on.prerequisite.WordCount README.md" 
    \end{lstlisting}
  \end{block}

  \begin{block}{You should obtain}
    \begin{lstlisting}[language=bash, style=terminal]
[info] Running psug.hands.on.prerequisite.WordCount README.md
[error] 15/05/08 17:37:36 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
[info] (,48)
[info] (*,24)
[info] (####,16)
[info] (of,14)
[info] (the,11)
[info] (###,10)
[info] (Exercise,8)
[info] (Description,8)
[info] (Notions,8)
[info] (a,8)
[success] Total time: 25 s, completed 8 mai 2015 17:37:39
    \end{lstlisting}
  \end{block}

\end{frame}

\begin{frame}[fragile]
  \frametitle{Words Count Script}

  \lstinputlisting[language=scala, style=code, label=WordCount,caption=/src/main/scala/psug/hands/on/prerequisite/WordCount.scala]{../src/main/scala/psug/hands/on/prerequisite/WordCount.scala}

\end{frame}

\begin{frame}
  \frametitle{Important Notions}

  \begin{block}{Vocabulary}
    \begin{itemize}
      \item \textbf{Spark Conf} Configuration of the Spark Context, here contains application name and master to call
      \item \textbf{Spark Context} Main entry point, represents the connection to a Spark Cluster, used to create RDDs/Load file
      \item \textbf{Resilient Distribued Dataset} Spark Dataset on which we can apply actions and transformations
      \item \textbf{Transformations} functions that transform RDD to another RDD
      \item \textbf{Actions} functions that transform an RDD to output data
    \end{itemize}
  \end{block}

\end{frame}

\begin{frame}
  \frametitle{Important Notions}

  \begin{block}{Spark Scripting How To}
    \begin{itemize}
      \item Initiate a Spark Context
      \item Load a dataset and transform it to RDD thanks to the Spark Context
      \item Register Transformations on RDD
      \item Apply an Action to transformed RDD
      \item Do whatever you want with data obtained after 
      \item Stop Spark Context
    \end{itemize}
  \end{block}

\end{frame}

\begin{frame}
  \frametitle{SBT Configuration}

  \lstinputlisting[language=scala, style=code, label=WordCount,caption=/build.sbt]{../build.sbt}

\end{frame}

\section{Exercise 1 : Spark basis (SparkContext, RDD, Transformation, Action)}

\begin{frame}
  \frametitle{Presentation of Exercise}

  \begin{block}{Statement}
    We dispose of three lists : first list contains the integers from 1 to 75, second list contains the integers from 25 to 100, and the third list contains primes under 100. We want to obtain the sum of square of integers that are under 100 and are not prime.
  \end{block}

  \begin{block}{What you will learn}
    \begin{itemize}
      \item Initialization of Spark Context
      \item Transform Scala lists to Spark RDDs
      \item Discover some transformations on RDDs
      \item Discover first action : sum
    \end{itemize}
  \end{block}

\end{frame}

\begin{frame}
  \frametitle{Exercise Code}

  \lstinputlisting[language=scala, style=code, label=Exercise1,caption=/src/main/scala/psug/hands/on/exercise01/SumOfSquareOfNonPrimeNumbers.scala]{../src/main/scala/psug/hands/on/exercise01/SumOfSquareOfNonPrimeNumbers.scala}

\end{frame}

\begin{frame}[fragile]
  \frametitle{New Notions (1)}

  \begin{lstlisting}[label=InitSparkContext, caption=Init Spark Context, language=scala, style=code]
val conf = new SparkConf().setMaster("local").setAppName("applicationName")
val sparkContext = new SparkContext(conf)
  \end{lstlisting}

  \begin{lstlisting}[label=ListToRdd, caption=Load List as RDD, language=scala, style=code]
val rdd:RDD[Int] = sparkContext.makeRDD(scalaList)
  \end{lstlisting}

\end{frame}

\begin{frame}[fragile]
  \frametitle{New Notions (2)}

  \begin{lstlisting}[label=RDDTransformation, caption=Apply transformation to RDD, language=scala, style=code]
val newRdd:RDD[Int] = oldRdd.map(x => x)
  \end{lstlisting}

  \begin{lstlisting}[label=RDDAction, caption=Apply action to RDD, language=scala, style=code]
val result:Int = rdd.sum()
  \end{lstlisting}

  \begin{lstlisting}[label=StopSparkContext, caption=Stop Spark Context, language=scala, style=code]
sparkContext.stop()
  \end{lstlisting}

\end{frame}

\begin{frame}

  \frametitle{New Transformations}

  

\end{frame}

\section{Exercise 2 : Key/Values RDD, File Loading}
\section{Exercise 3 : Spark SQL Context, JSON Loading, DataFrames}
\section{Exercise 4 : Transformations/Actions on DataFrames, Join}
\section{Exercise 5 : Transformations/Actions on DataFrames}
\section{Exercise 6 : Saving JSON file}
\section{Exercise 7 : Machine Learning}


\end{CJK}
\end{document}
